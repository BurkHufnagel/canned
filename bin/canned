#!/usr/bin/env node
var canned = require('../canned')
,   http = require('http')
,   optimist = require('optimist')
,   argv = optimist
          .default('p', 3000)
          .alias('p', 'port')
          .describe('p', 'server port')
          .default('cors', true)
          .describe('cors', 'disable cors support')
          .default('h', false)
          .alias('h', 'help')
          .describe('h', 'show the help')
          .usage('Usage: $0 [dir]')
          .argv

if(argv.h) {
  optimist.showHelp()
  return
}

var dir = ''
,   port = argv.p
,   cors = argv.c
,   logger
,   cannedDir

if(argv._.length === 1) dir = argv._[0] // use the passed directory
if(argv.q) {
  logger = null // be quiet
} else {
  logger = process.stdout
  dir.length === 0 ? cannedDir = './' : cannedDir = dir
  process.stdout.write('starting canned on port ' + port + ' for ' + cannedDir + '\n')
}

var can = canned(dir, { logger: logger, cors: cors})
http.createServer(can).listen(port)

